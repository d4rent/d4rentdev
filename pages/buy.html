<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D4Rent - Buy</title>
  <link rel="stylesheet" href="../css/rent.css">
</head>
<body>
  <!-- Header -->
  <header>
    <div class="logo-container">
      <a href="../index.html">
        <img src="https://d4rent.ie.s3.eu-west-1.amazonaws.com/assets/d4rent.ielogobuyrentsell.png" alt="D4Rent Logo">
      </a>
    </div>
    <div class="nav-login-container">
      <nav>
        <ul>
           <li><a href="buy.html">Buy</a></li>
           <li><a href="rent.html">Rent</a></li>
           <li><a href="commercial.html">Commercial</a></li>
           <li><a href="services.html">Services</a></li>
           <li class="dropdown">
            <a href="agents.html">Agents</a>
            <ul class="dropdown-menu">
              <li><a href="agents.html">Real Estate Agents</a></li>
            </ul>
          </li>
          <li><a href="concierge.html">Concierge</a></li>
          <li><a href="sell.html">Why Us?</a></li>
          <li><a href="contact-us.html" class="contact-button">Contact Us</a></li>
        </ul>
      </nav>
      <a href="login.html" class="login-button">
        <img src="https://d4rent.ie.s3.eu-west-1.amazonaws.com/assets/download.jpg" alt="User Profile">
      </a>
    </div>
  </header>

  <section class="full-width-slideshow">
    <div class="slideshow-container">
      <div class="slide fade">
        <img src="https://d4rent.ie.s3.eu-west-1.amazonaws.com/assets/IMAGE10.jpg" alt="Slideshow Image 1">
      </div>
      <div class="slide fade">
        <img src="https://d4rent.ie.s3.eu-west-1.amazonaws.com/assets/IMAGE8.jpg" alt="Slideshow Image 2">
      </div>
      <div class="slide fade">
        <img src="https://d4rent.ie.s3.eu-west-1.amazonaws.com/assets/IMAGE9.jpg" alt="Slideshow Image 3">
      </div>
      <div class="slideshow-text">
        <h2>Buying a Home is a Big Deal. We Can Make it a Great One!</h2>
      </div>
    </div>
  </section>

  <!-- Page Title -->
  <section class="page-title">
    <h1>Properties for Sale</h1>
  </section>

  <!-- Search Filter Section -->
  <section class="search-filter">
    <form action="#" method="GET" class="filter-form" id="buy-filter-form">
      <div class="filter-group">
        <label for="price">Price Range:</label>
        <select id="price" name="price">
          <option value="">Any</option>
          <option value="0-100000">€0 - €100,000</option>
          <option value="100000-200000">€100,000 - €200,000</option>
          <option value="200000-500000">€200,000 - €500,000</option>
          <option value="500000-700000">€500,000 - €700,000</option>
          <option value="700000-1000000">€700,000 - €1,000,000</option>
          <option value="1000000-10000000">€1,000,000 - €10,000,000</option>
          <option value="10000000+">€10,000,000+</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="beds">Bedrooms:</label>
        <select id="beds" name="beds">
          <option value="">Any</option>
          <option value="1">1 Bedroom</option>
          <option value="2">2 Bedrooms</option>
          <option value="3">3 Bedrooms</option>
          <option value="4+">4+ Bedrooms</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="type">Property Type:</label>
        <select id="type" name="type">
          <option value="">Any</option>
          <option value="house">House</option>
          <option value="apartment">Apartment</option>
          <option value="villa">Villa</option>
          <option value="commercial">Commercial</option>
          <option value="georgian">Georgian</option>
          <option value="detached">Detached</option>
          <option value="semi-detached">Semi-Detached</option>
        </select>
      </div>
      <button type="submit" class="filter-button">Search</button>
    </form>
  </section>

  <!-- Properties Section -->
  <section class="properties">
    <div class="property-grid" id="buy-property-grid">
      <!-- Properties will be rendered here by JS -->
    </div>
  </section>

  <footer>
    <div class="footer-container">
      <div class="footer-image">
        <img src="https://d4rent.ie.s3.eu-west-1.amazonaws.com/assets/d4rent.ielogobuyrentsell.png" alt="D4Rent Footer Logo">
      </div>
      <div class="footer-section">
        <h3>Contact Details</h3>
        <p>D4RENT.IE</p>
        <p>36 Upper Baggot St, Ballsbridge, D4</p>
        <p>Phone: 01 442 7303</p>
        <p>087 169 9498</p>
        <p>Email: <a href="mailto:info@d4rent.ie">info@d4rent.ie</a></p>
      </div>
      <div class="footer-section">
        <h3>Quick Links</h3>
        <ul>
          <li><a href="buy.html">Buy</a></li>
          <li><a href="sell.html">Sell</a></li>
          <li><a href="rent.html">Rent</a></li>
          <li><a href="agents.html">Agents</a></li>
          <li><a href="landlords.html">Landlords</a></li>
          <li><a href="commercial.html">Commercial</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Policy Links</h3>
        <ul>
          <li><a href="privacy-policy.html">Privacy Policy</a></li>
          <li><a href="terms-of-service.html">Terms of Service</a></li>
          <li><a href="cookie-policy.html">Cookie Policy</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Connect with Us</h3>
        <ul>
          <li><a href="https://facebook.com" target="_blank">Facebook</a></li>
          <li><a href="https://twitter.com" target="_blank">Twitter</a></li>
          <li><a href="https://instagram.com" target="_blank">Instagram</a></li>
          <li><a href="https://linkedin.com" target="_blank">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    <div class="psra-number">PSRA No 003328</div>
  </footer>

  <script>
    // Only declare API_BASE_URL if not already defined
    if (typeof API_BASE_URL === 'undefined') {
      var API_BASE_URL = 'http://d4rent-env.eba-nyk56kew.eu-west-1.elasticbeanstalk.com';
    }

    // Fetch and render all properties for sale
    async function fetchAndRenderBuyProperties(filters = {}) {
      let url = `${API_BASE_URL}/api/properties`;
      const params = [];
      if (filters.status) params.push('status=' + encodeURIComponent(filters.status));
      if (filters.price) params.push('price=' + encodeURIComponent(filters.price));
      if (filters.beds) params.push('beds=' + encodeURIComponent(filters.beds));
      if (filters.type) params.push('type=' + encodeURIComponent(filters.type));
      if (params.length) url += '?' + params.join('&');

      let properties = [];
      try {
        const res = await fetch(url);
        properties = await res.json();
      } catch (e) {
        properties = [];
      }
      // Only show properties for sale (status: "for sale" or "sale agreed")
      properties = properties.filter(
        p => p.status && (p.status.toLowerCase() === 'for sale' || p.status.toLowerCase() === 'sale agreed')
      );
      renderBuyProperties(properties);
    }

    function renderBuyProperties(properties) {
      const grid = document.getElementById('buy-property-grid');
      if (!grid) return;
      if (!properties || properties.length === 0) {
        grid.innerHTML = '<p style="grid-column: 1/-1; color: #888;">No properties for sale at the moment.</p>';
        return;
      }
      grid.innerHTML = properties.map(listing => `
        <div class="profile-listing-card">
          <div class="property-header-bar">
            <img src="${listing.company_logo ? '/uploads/' + listing.company_logo : 'https://via.placeholder.com/120x40?text=Logo'}" class="company-logo-bar" alt="Company Logo">
          </div>
          <div class="property-main-image">
            <img src="${listing.image ? '/uploads/' + listing.image : 'https://via.placeholder.com/400x225?text=No+Image'}" alt="Property Image">
          </div>
          <div class="property-details">
            <div class="property-title" style="font-weight:700;font-size:1.2em;">${listing.title || ''}</div>
            <div class="property-address">${listing.address || ''}</div>
            <div class="property-size">${listing.property_size ? `Size: ${listing.property_size}` : ''}</div>
            <div class="property-price"><strong>Price:</strong> €${listing.price}</div>
            <div class="property-status-row">
              <span class="property-status">${listing.status ? listing.status.replace('_', ' ').toUpperCase() : ''}</span>
            </div>
            <a href="propertytemplateRENT.html?id=${listing.id}" class="view-details orange-btn" style="margin-top:0.7em;display:block;text-align:center;">View Details</a>
          </div>
        </div>
      `).join('');
    }

    // Filter form handler
    document.getElementById('buy-filter-form').onsubmit = function(e) {
      e.preventDefault();
      const price = document.getElementById('price').value;
      const beds = document.getElementById('beds').value;
      const type = document.getElementById('type').value;
      fetchAndRenderBuyProperties({
        status: '', // We'll filter for "for sale" and "sale agreed" in JS
        price,
        beds,
        type
      });
    };

    // Initial load
    fetchAndRenderBuyProperties();
  </script>
  <script src="../scripts/main.js"></script>
</body>
</html>